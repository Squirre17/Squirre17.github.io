<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Squirre17 Blog - Sakana~</title><meta name="keywords" content="newbie"><meta name="author" content="Squirre17"><meta name="copyright" content="Squirre17"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="introvert">
<meta property="og:type" content="website">
<meta property="og:title" content="Squirre17 Blog">
<meta property="og:url" content="https://squirre17.github.io/index.html">
<meta property="og:site_name" content="Squirre17 Blog">
<meta property="og:description" content="introvert">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://squirre17.github.io/imgs/avatar.jpg">
<meta property="article:author" content="Squirre17">
<meta property="article:tag" content="newbie">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://squirre17.github.io/imgs/avatar.jpg"><link rel="shortcut icon" href="/img/favicon-32x32.png"><link rel="canonical" href="https://squirre17.github.io/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Squirre17 Blog',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2022-11-03 19:20:55'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="Squirre17 Blog" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/imgs/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">15</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">13</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">7</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header" style="background-image: url('https://squblogs.oss-cn-nanjing.aliyuncs.com/%E5%9B%BE%E7%89%87/Lycoris/Lycoris/index.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Squirre17 Blog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">Squirre17 Blog</h1><div id="site-subtitle"><span id="subtitle"></span></div><div id="site_social_icons"><a class="social-icon" href="https://github.com/Squirre17" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:Ler2sq@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left"><a href="/2022/11/03/afl-forkserver-maneuver/" title="afl-forkserver-maneuver"><img class="post_bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/imgs/yukisetsuna1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="afl-forkserver-maneuver"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/11/03/afl-forkserver-maneuver/" title="afl-forkserver-maneuver">afl-forkserver-maneuver</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-11-03T11:12:15.000Z" title="Created 2022-11-03 19:12:15">2022-11-03</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-11-03T11:20:43.875Z" title="Updated 2022-11-03 19:20:43">2022-11-03</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Static-Analysis/">Static Analysis</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/afl/">afl</a></span></div><div class="content"># forkserver 的目的
参见 lcamtuf.blogspot
 如果每次由 fuzzer 来进行 fork-execve 那么每次目标程序都得进装载器链接器和动态加载库打一套 十分浪费时间。
但是 如果我们劫持了目标程序的_start 让目标程序一开始执行我们写入的 forkserver 代码，这样就能在装载之后通过 COW 实现低成本的 fork。
也就是 forkserver 本身就注入到目标程序里面去了，作为目标程序的起始点不断的进行 fork。

# trampoline
这个被插桩到每个基本块之前
1234567891011121314151617181920static const u8* trampoline_fmt_64 =  &quot;\n&quot;  &quot;/* --- AFL TRAMPOLINE (64-BIT) --- */\n&quot;  &quot;\n&quot;  &quot;.align 4\n&quot;  &quot;\n&quot;  &quot;leaq -(128+24)(%%rsp), %%rsp\n&quot;  ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2022/11/02/CVE-2022-0847-DIRTY-PIPE-detail/" title="CVE-2022-0847-DIRTY-PIPE-detail"><img class="post_bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/imgs/mashiro1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CVE-2022-0847-DIRTY-PIPE-detail"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/11/02/CVE-2022-0847-DIRTY-PIPE-detail/" title="CVE-2022-0847-DIRTY-PIPE-detail">CVE-2022-0847-DIRTY-PIPE-detail</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-11-02T14:19:00.000Z" title="Created 2022-11-02 22:19:00">2022-11-02</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-11-02T14:55:03.479Z" title="Updated 2022-11-02 22:55:03">2022-11-02</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/CVE-recur/">CVE recur</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Kernel/">Kernel</a></span></div><div class="content"># basic
(之后会把 docker 做好传上去 以后就不用折腾了 QAQ)
https://hub.docker.com/repository/docker/squirre17/dirtypipe
# page cache
Linux 的换页机制是脏页机制，也就是写一个文件是通过写内存缓存页，然后标记脏位，在换页的时候一次性写回磁盘。而不是每次都写磁盘。
在打开文件的时候可以用 O_DIRECT | O_SYNC  来标记对脏页进行直写策略，换回同步。
但这里并不是对文件进行硬存级别的篡改，假设文件进了内存，然后我修改了这个文件内存中的部分内容，短时间再次访问这个文件会直接从内存缓存中拿到我们篡改过的内容而不是去 disk 上取。
# structs
# file
fs.h - include/linux/fs.h - Linux source code (v5.13-rc1) - Bootlin
 每一个打开的文件描述符和一个 struct 相对应

pipe_inode_info 指向一个内核管道

1234567891011struct file &#123;...     ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2022/10/30/debugger-impl/" title="debugger-impl"><img class="post_bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/imgs/hitoli1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="debugger-impl"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/10/30/debugger-impl/" title="debugger-impl">debugger-impl</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-10-30T06:46:09.000Z" title="Created 2022-10-30 14:46:09">2022-10-30</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-10-30T06:50:02.846Z" title="Updated 2022-10-30 14:50:02">2022-10-30</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/basic/">basic</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/debugger/">debugger</a></span></div><div class="content">How debuggers work: Part 1 - Basics - Eli Bendersky’s website
 单纯的复现此文章。
# single step
首先是 ptrace
12long ptrace(enum __ptrace_request request, pid_t pid,                 void *addr, void *data);
对于第一个 request 的参数

PTRACE_TRACEME  request, which means that this child process asks the OS kernel to let its parent trace it.
这个参数只用于子进程，所以这里是在 fork 之后

第三个对地址进行和第四个是地址操作相关，根据 request 的类型，是对这个 addr 进行 poke，或者 peek 这个数据到 data 里（或者直接 peek 到返回值）。

Indicates that this process is to be traced by its parent.  ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2022/10/26/Ghidra-INDIRECT-explanation/" title="Ghidra-INDIRECT-explanation"><img class="post_bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/imgs/yuigahama1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Ghidra-INDIRECT-explanation"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/10/26/Ghidra-INDIRECT-explanation/" title="Ghidra-INDIRECT-explanation">Ghidra-INDIRECT-explanation</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-10-26T10:05:02.000Z" title="Created 2022-10-26 18:05:02">2022-10-26</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-11-03T11:13:00.565Z" title="Updated 2022-11-03 19:13:00">2022-11-03</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Static-Analysis/">Static Analysis</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Ghidra/">Ghidra</a></span></div><div class="content">123456789undefined4 FUN_000114b8(void)&#123;  undefined4 in_r3;    printf(&quot;%s(%d)\n&quot;,&quot;part_data_end&quot;,0x7d,in_r3,in_r3);  return 0;&#125;
output result as following (pcode-refined)
123456789(ram, 0x114d4, 4) INDIRECT (ram, 0x114d4, 4) , (const, 0x15, 4)(ram, 0x114d8, 4) INDIRECT (ram, 0x114d8, 4) , (const, 0x15, 4) ---  CALL (ram, 0x10ba4, 8) , (ram, 0x114d8, 4) , (ram, 0x114d4, 4) , (const, 0x7d, 4) , (register, 0x2c, 4) , (register, 0x2c, 4)(register, 0x20, 4) COPY (const, 0 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2022/10/18/shared-memory-and-semaphore-machenism/" title="shared-memory-and-semaphore-machenism"><img class="post_bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/imgs/yume2.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="shared-memory-and-semaphore-machenism"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/10/18/shared-memory-and-semaphore-machenism/" title="shared-memory-and-semaphore-machenism">shared-memory-and-semaphore-machenism</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-10-18T06:57:37.000Z" title="Created 2022-10-18 14:57:37">2022-10-18</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-10-18T07:05:35.333Z" title="Updated 2022-10-18 15:05:35">2022-10-18</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/C/">C</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Linux/">Linux</a></span></div><div class="content"># 分类

管道
消息队列
信号
共享内存
信号量
套接字

# 共享内存
1234int shmget(key_t key, size_t size, int shmflg);void *shmat(int shmid, const void *shmaddr, int shmflg);int shmdt(const void *shmaddr);int shmctl(int shmid, int cmd, struct shmid_ds *buf);
   shmget()  returns  the identifier of the System V shared memory segment associated with the value of the argument key.  It may be used either to obtain the identifier of a previously created shared memory segment  (when shmflg is zero and key does not have the value  ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2022/10/18/llvm-init/" title="llvm-init"><img class="post_bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/imgs/aijo1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="llvm-init"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/10/18/llvm-init/" title="llvm-init">llvm-init</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-10-18T02:27:10.000Z" title="Created 2022-10-18 10:27:10">2022-10-18</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-10-18T02:35:32.980Z" title="Updated 2022-10-18 10:35:32">2022-10-18</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Static-Analysis/">Static Analysis</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/llvm/">llvm</a></span></div><div class="content">123sudo apt install lld-12sudo ln -s /lib/llvm-9/bin/llc /bin/llcsudo ln -s /lib/llvm-9/bin/opt /bin/opt
官方文档：LLVM Language Reference Manual — LLVM 16.0.0git documentation
1clang -Xclang -ast-dump -fsyntax-only test.c
生成 AST

-S                      Only run preprocess and compilation steps
-emit-llvm         Use the LLVM representation for assembler and object files
-c                      Only run preprocess, compile, and assemble steps （生成字节码的 bc 文件）

1clang -S -emit-llvm test.c 
生成的 ir 中
123 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2022/09/29/hexp-2020-kernel-rop/" title="hexp-2020-kernel-rop"><img class="post_bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/imgs/aijo2.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="hexp-2020-kernel-rop"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/09/29/hexp-2020-kernel-rop/" title="hexp-2020-kernel-rop">hexp-2020-kernel-rop</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-09-29T14:53:15.000Z" title="Created 2022-09-29 22:53:15">2022-09-29</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-10-18T02:37:30.029Z" title="Updated 2022-10-18 10:37:30">2022-10-18</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/CTF/">CTF</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Linux/">Linux</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/Kernel-state/">Kernel state</a></span></div><div class="content">Challenges
hxpCTF 2020 kernel-rop
 已经同步到 gittee
先读取出 init 的文件系统
12gunzip initramfs.cpio.gzmv vmlinuz vmlinux
设置 inittab 中 sh 权限为 root
1setuidgid 0000 sh
# hackme.so
1234567891011121314151617181920ssize_t __fastcall hackme_write(file *f, const char *data, size_t size, loff_t *off)&#123;  unsigned __int64 v4; // rdx  ssize_t size_1; // rbx  int tmp[32]; // [rsp+0h] [rbp-A0h] BYREF  unsigned __int64 v8; // [rsp+80h] [rbp-20h]  size_1 = v4;  v8 = __readgsqword(0x28u);  if ( v4 &gt; 0x1000 )  &#123;  ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2022/09/16/a-easy-virtualization-challenge/" title="a-easy-virtualization-challenge"><img class="post_bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/imgs/kurisu1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="a-easy-virtualization-challenge"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/09/16/a-easy-virtualization-challenge/" title="a-easy-virtualization-challenge">a-easy-virtualization-challenge</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-09-16T02:43:40.000Z" title="Created 2022-09-16 10:43:40">2022-09-16</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-09-30T01:53:20.138Z" title="Updated 2022-09-30 09:53:20">2022-09-30</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/CTF/">CTF</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Linux/">Linux</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/virtualization/">virtualization</a></span></div><div class="content">12345678910111213__int64 __fastcall sub_5713A8(__int64 a1)&#123;  __int64 result; // rax  result = sub_70031D(a1, &quot;pci-device&quot;, &quot;/home/wang/qemu/hw/misc/myrfid.c&quot;, 369LL, &quot;rfid_class_init&quot;);  *(_QWORD *)(result + 176) = qxl_reset_handler;  *(_QWORD *)(result + 184) = 0LL;  *(_WORD *)(result + 208) = 0x420;          [1] &lt;&lt;- vendor_id  *(_WORD *)(result + 210) = 0x1337;         [2] &lt;&lt;- device_id  *(_BYTE *)(result + 212) = 0x69;  *(_WORD *)(result + 214) = ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2022/09/12/2022-cakeCTF-pwn-wp/" title="2022-cakeCTF-pwn-wp"><img class="post_bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/imgs/chisato1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2022-cakeCTF-pwn-wp"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/09/12/2022-cakeCTF-pwn-wp/" title="2022-cakeCTF-pwn-wp">2022-cakeCTF-pwn-wp</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-09-12T11:39:37.000Z" title="Created 2022-09-12 19:39:37">2022-09-12</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-09-30T01:52:54.577Z" title="Updated 2022-09-30 09:52:54">2022-09-30</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/CTF/">CTF</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Linux/">Linux</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/writeup/">writeup</a></span></div><div class="content">CakeCTF 2022
# welkerme
没开 kaslr 没开 smep
 找到 cc 和 pkc 一把梭了
# str.vs.cstr
c++ 简单溢出
没开 pie 和 relro
12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364#include &lt;array&gt;#include &lt;iostream&gt;struct Test &#123;	Test() &#123;		std::fill(_c_str, _c_str + 0x20, 0);	&#125;	char* c_str() &#123; return _c_str; &#125;	std::string&amp; str() &#123; return _str; &#125;private:	__attribute__((used))	void call_me() &#123;		std::system(& ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2022/09/11/kernel-notebook-three-solutions/" title="kernel-notebook-three-solutions"><img class="post_bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/imgs/takina1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="kernel-notebook-three-solutions"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/09/11/kernel-notebook-three-solutions/" title="kernel-notebook-three-solutions">kernel-notebook-three-solutions</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-09-11T02:28:41.000Z" title="Created 2022-09-11 10:28:41">2022-09-11</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-09-30T01:52:30.123Z" title="Updated 2022-09-30 09:52:30">2022-09-30</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/CTF/">CTF</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Linux/">Linux</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/Kernel-state/">Kernel state</a></span></div><div class="content"># notebook 的多种解法
2021 QWB
这个题就是考锁没加好的多线程条件竞争
# 传统 ROP -ptmx
利用 realloc 指针延迟回写的效果 将 free 的块回写回控制区
造成对 tty struct 结构体的控制
然后泄漏 kernel base
并两段栈迁移 (测试过 一段迁移不行 会卡在一个地方)
1234567891011121314151617181920212223242526272829303132333435363738394041424344__int64 __fastcall noteedit(size_t idx, size_t newsize, void *buf)&#123;  __int64 v3; // rdx  __int64 v4; // r13  note *v5; // rbx  size_t size; // rax  __int64 v7; // r12  __int64 v8; // rbx  (···)    v4 = v3;  v5 = &amp;notebook[idx];  raw_read_lock(&amp; ...</div></div></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/#content-inner">2</a><a class="extend next" rel="next" href="/page/2/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/imgs/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Squirre17</div><div class="author-info__description">introvert</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">15</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">13</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">7</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Squirre17"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Squirre17" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:Ler2sq@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">Beta Blog</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/11/03/afl-forkserver-maneuver/" title="afl-forkserver-maneuver"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/imgs/yukisetsuna1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="afl-forkserver-maneuver"/></a><div class="content"><a class="title" href="/2022/11/03/afl-forkserver-maneuver/" title="afl-forkserver-maneuver">afl-forkserver-maneuver</a><time datetime="2022-11-03T11:12:15.000Z" title="Created 2022-11-03 19:12:15">2022-11-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/02/CVE-2022-0847-DIRTY-PIPE-detail/" title="CVE-2022-0847-DIRTY-PIPE-detail"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/imgs/mashiro1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CVE-2022-0847-DIRTY-PIPE-detail"/></a><div class="content"><a class="title" href="/2022/11/02/CVE-2022-0847-DIRTY-PIPE-detail/" title="CVE-2022-0847-DIRTY-PIPE-detail">CVE-2022-0847-DIRTY-PIPE-detail</a><time datetime="2022-11-02T14:19:00.000Z" title="Created 2022-11-02 22:19:00">2022-11-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/10/30/debugger-impl/" title="debugger-impl"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/imgs/hitoli1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="debugger-impl"/></a><div class="content"><a class="title" href="/2022/10/30/debugger-impl/" title="debugger-impl">debugger-impl</a><time datetime="2022-10-30T06:46:09.000Z" title="Created 2022-10-30 14:46:09">2022-10-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/10/26/Ghidra-INDIRECT-explanation/" title="Ghidra-INDIRECT-explanation"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/imgs/yuigahama1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Ghidra-INDIRECT-explanation"/></a><div class="content"><a class="title" href="/2022/10/26/Ghidra-INDIRECT-explanation/" title="Ghidra-INDIRECT-explanation">Ghidra-INDIRECT-explanation</a><time datetime="2022-10-26T10:05:02.000Z" title="Created 2022-10-26 18:05:02">2022-10-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/10/18/shared-memory-and-semaphore-machenism/" title="shared-memory-and-semaphore-machenism"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/imgs/yume2.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="shared-memory-and-semaphore-machenism"/></a><div class="content"><a class="title" href="/2022/10/18/shared-memory-and-semaphore-machenism/" title="shared-memory-and-semaphore-machenism">shared-memory-and-semaphore-machenism</a><time datetime="2022-10-18T06:57:37.000Z" title="Created 2022-10-18 14:57:37">2022-10-18</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>Categories</span>
            
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/C/"><span class="card-category-list-name">C</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/CTF/"><span class="card-category-list-name">CTF</span><span class="card-category-list-count">4</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/CVE-recur/"><span class="card-category-list-name">CVE recur</span><span class="card-category-list-count">3</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Static-Analysis/"><span class="card-category-list-name">Static Analysis</span><span class="card-category-list-count">3</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Tips/"><span class="card-category-list-name">Tips</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/basic/"><span class="card-category-list-name">basic</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/ctf/"><span class="card-category-list-name">ctf</span><span class="card-category-list-count">2</span></a></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>Tags</span></div><div class="card-tag-cloud"><a href="/tags/Blockchain/" style="font-size: 1.3em; color: #99a1ac">Blockchain</a> <a href="/tags/Ghidra/" style="font-size: 1.1em; color: #999">Ghidra</a> <a href="/tags/IoT/" style="font-size: 1.1em; color: #999">IoT</a> <a href="/tags/Kernel/" style="font-size: 1.1em; color: #999">Kernel</a> <a href="/tags/Kernel-state/" style="font-size: 1.3em; color: #99a1ac">Kernel state</a> <a href="/tags/Linux/" style="font-size: 1.5em; color: #99a9bf">Linux</a> <a href="/tags/Tips/" style="font-size: 1.1em; color: #999">Tips</a> <a href="/tags/User-state/" style="font-size: 1.1em; color: #999">User state</a> <a href="/tags/afl/" style="font-size: 1.1em; color: #999">afl</a> <a href="/tags/debugger/" style="font-size: 1.1em; color: #999">debugger</a> <a href="/tags/llvm/" style="font-size: 1.1em; color: #999">llvm</a> <a href="/tags/virtualization/" style="font-size: 1.1em; color: #999">virtualization</a> <a href="/tags/writeup/" style="font-size: 1.1em; color: #999">writeup</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>Archives</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/11/"><span class="card-archive-list-date">November 2022</span><span class="card-archive-list-count">2</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/10/"><span class="card-archive-list-date">October 2022</span><span class="card-archive-list-count">4</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/09/"><span class="card-archive-list-date">September 2022</span><span class="card-archive-list-count">5</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/08/"><span class="card-archive-list-date">August 2022</span><span class="card-archive-list-count">2</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/08/"><span class="card-archive-list-date">August 2021</span><span class="card-archive-list-count">2</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>Info</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">Article :</div><div class="item-count">15</div></div><div class="webinfo-item"><div class="item-name">Run time :</div><div class="item-count" id="runtimeshow" data-publishDate="2022-08-10T16:00:00.000Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">UV :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">PV :</div><div class="item-count" id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">Last Push :</div><div class="item-count" id="last-push-date" data-lastPushDate="2022-11-03T11:20:54.890Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Squirre17</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>function subtitleType () {
  if (true) { 
    window.typed = new Typed("#subtitle", {
      strings: ["切っ先に栄光止まれ"],
      startDelay: 300,
      typeSpeed: 150,
      loop: true,
      backSpeed: 50
    })
  } else {
    document.getElementById("subtitle").innerHTML = '切っ先に栄光止まれ'
  }
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.jsdelivr.net/npm/typed.js/lib/typed.min.js').then(subtitleType)
  }
} else {
  subtitleType()
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>